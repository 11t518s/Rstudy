########################################
## ?????ㅽ?? 留???대?? 遺???? 
########################################

###############
# 1. ?????? 遺????  
###############

## 媛???몄????쇰?? ????????대낫湲?




extractNoun('안녕하세요 최봉수입니당 ㅎ_ㅎ')









# ?????ㅽ?몃????대????? ?????? ??⑦?ㅼ?? ??ㅼ?? 

# ?????? 遺??????? ?????? ??⑦?ㅼ?? ??ㅼ??
install.packages(c("KoNLP", "wordcloud"))
# tm ??⑦?ㅼ?? 援? 踰???? ??ㅼ?대?????/??ㅼ?? - version 3.3.2
install.packages("http://cran.r-project.org/bin/windows/contrib/3.0/tm_0.5-10.zip",repos=NULL)
install.packages('slam')
install.packages('Sejong')
install.packages('hash')
install.packages('tau')
install.packages('devtools')
install.packages('NLP')



library(rJava)

install.packages("KoNLP")
useNIADic()
setwd('/Users/bongsu/Downloads')
sessionInfo()

#setwd(readClipboard())
setwd("/Users/bongsu/Downloads/data/part2")
Sys.setenv(JAVA_HOME="/Users/bongsu/Downloads/jdk-17.0.1.jdk/Contents/Home")
dyn.load("/Library/Java/JavaVirtualMachines/temurin-16.jdk/Contents/Home/lib/server/libjvm.dylib")
Sys.getenv()

Sys.getenv("JAVA_HOME")


install.packages('KoNLP')
.jinit()

# ??⑦?ㅼ?? 濡????
library(rJava) 
library(slam) 
library(RSQLite)
library(httr)
library(XML)
library(KoNLP) # ??몄????ъ?? 
library(NLP)
library(tm) # ???臾? ?????ㅽ?? 留???대?? 
library(wordcloud) # RColorBrewer()??⑥?? ???怨?


# 紐???? 異?異? ??? 
extractNoun('???????????몄??. ???湲몃?? ?????????.')



# (1) ?????ㅽ?? ???猷? 媛???몄?ㅺ린 
facebook <- file("facebook_bigdata.txt", encoding="UTF-8")
facebook_data <- readLines(facebook) # 以? ??⑥?? ??곗?댄?? ??????
head(facebook_data) # ???遺?遺? 6以? 蹂닿린 - 以? ??⑥?? 臾몄?? ?????? 
str(facebook_data) # chr [1:76]

# (2) ???猷?吏?(Corpus) ?????? 
facebook_corpus <- Corpus(VectorSource(facebook_data))
facebook_corpus 
inspect(facebook_corpus) # 76媛? ???猷?吏???? ??ы?⑤?? 臾몄?? ??? ???怨? 


# (3)??⑥?? 異?媛???? ??⑥?댁??異? 
# ??몄?? ??ъ????? ?????? ??⑥?? 異?媛?
#install.packages('curl')
library(curl)
useSejongDic() # ??몄?? ??ъ?? 遺???ъ?ㅺ린
mergeUserDic(data.frame(c("R ???濡?洹몃??諛?","?????댁?ㅻ??","????????ㅽ?몄?????"), c("ncn"))) 
# ncn -紐???ъ?????肄????

# (4) ??⑥?댁??異? ??ъ?⑹?? ??⑥?? ?????? 
# ??ъ?⑹?? ?????? ??⑥?? ?????? 
exNouns <- function(x) { paste(extractNoun(as.character(x)), collapse=" ")}
# exNouns ??⑥?? ??댁?? ??⑥?? 異?異? 
facebook_nouns <- sapply(facebook_corpus, exNouns) 
facebook_nouns[1] # ??⑥?대?? 異?異???? 泥? 以? 蹂닿린 

# (5) 異?異???? ??⑥?? ?????? ???泥?由?
# 異?異???? ??⑥?? ??댁?? ???猷?吏? ??????
myCorputfacebook <- Corpus(VectorSource(facebook_nouns)) 
myCorputfacebook 
# ??곗?댄?? ???泥?由? 
myCorputfacebook <- tm_map(myCorputfacebook, removePunctuation) # 臾몄?λ????? ???嫄?
myCorputfacebook <- tm_map(myCorputfacebook, removeNumbers) # ???移? ???嫄?
myCorputfacebook <- tm_map(myCorputfacebook, tolower) # ???臾몄?? 蹂?寃?
myStopwords = c(stopwords('english'), "??ъ??", "???湲?")
myCorputfacebook <-tm_map(myCorputfacebook, removeWords, myStopwords) # 遺???⑹?댁??嫄?
inspect( myCorputfacebook[1:5])

# (6) ??⑥?? ???蹂?(??⑥?? 湲몄?? 2媛? ??댁??)
# ??⑥?닿만??? 2媛? ??댁????? ??⑥?대?? ???蹂??????? matrix ???猷?援ъ“濡? 蹂?寃?
myCorputfacebook_term <- TermDocumentMatrix(myCorputfacebook, control=list(wordLengths=c(2,Inf)))

# matrix ???猷?援ъ“瑜? data.frame ???猷?援ъ“濡? 蹂?寃?
myTermfacebook.df <- as.data.frame(as.matrix(myCorputfacebook_term)) 
dim(myTermfacebook.df) 

# (7) ??⑥?? 鍮??????? 援ы??湲? - 鍮???????媛? ?????? ?????????濡? ??대┝李⑥?? ??????
wordResult <- sort(rowSums(myTermfacebook.df), decreasing=TRUE) # 鍮???????濡? ??대┝李⑥?? ??????
wordResult[1:10]

# (8) ??⑥?? 援щ??(wordcloud) ?????? - ????????? ?????? ???
myName <- names(wordResult) # ??⑥?? ??대?? ?????? -> 鍮?????????? ??대?? 
wordcloud(myName, wordResult) # ??⑥?닿뎄由? ??????


# (9) ??⑥?? 援щ????? ????????? ??????(鍮???????, ??????, ???移?, ?????? ???) 
# ??⑥?댁?대??怨? 鍮???????濡? data.frame ??????
word.df <- data.frame(word=myName, freq=wordResult) 
str(word.df) # word, freq 蹂????

# ??⑥?? ??????怨? 湲?瑗? 吏????
pal <- brewer.pal(12,"Paired") # 12媛?吏? ?????? pal <- brewer.pal(9,"Set1") # Set1~ Set3
# ??고?? ??ㅼ????명?? : "留???? 怨????", "?????몃?⑥?곗껜 B"
windowsFonts(malgun=windowsFont("留???? 怨????"))  #windows

# ??⑥?? 援щ?? ???媛???? - 蹂??????? 李쎌?? ??????, 鍮???????, 湲?瑗?, ?????? ??깆?? ?????? ?????? 
#x11( ) # 蹂??????? 李쎌?? ?????곕?? ??⑥??
wordcloud(word.df$word, word.df$freq, 
          scale=c(5,1), min.freq=3, random.order=F, 
          rot.per=.1, colors=pal, family="malgun")


#################
## 2 ??곌????? 遺???? 
#################

# ???湲? 泥?由щ?? ?????? ??⑦?ㅼ?? ??ㅼ??
#install.packages('rJava')
#Sys.setenv(JAVA_HOME='C:\\Program Files\\Java\\jre1.8.0_151')
#library(rJava) # ????????? 媛???? Error 諛???? ??? Sys.setenv()??⑥??濡? java 寃쎈?? 吏????
#install.packages("KoNLP") 
#library(KoNLP) # rJava ??쇱?대????щ━媛? ?????????


# (1) ?????ㅽ?? ?????? 媛???몄?ㅺ린 ('鍮???곗?댄??'??ㅼ?????濡? ?????댁?ㅻ???????? 寃??????? 寃곌낵?????쇱??)
marketing <- file("marketing.txt", encoding="UTF-8")
marketing2 <- readLines(marketing) # 以? ??⑥?? ??곗?댄?? ??????
# incomplete final line found on - Error 諛???? ??? UTF-8 ??몄????? 諛⑹????쇰?? ??? ??????
close(marketing) 


# (2) 以? ??⑥?? ??⑥?? 異?異?
lword <- Map(extractNoun, marketing2)  
length(lword) # [1] key = 472

lword <- unique(lword) # 以?蹂듭??嫄?1(???泥? ??????)
length(lword) # [1] 353 (19媛? ???嫄?)

# (3) 以?蹂듬?⑥?? ???嫄곗?? 異?異? ??⑥?? ??????
lword <- sapply(lword, unique) # 以?蹂듭??嫄?2 (以? ??⑥?? ??????) 
length(lword) # [1] 353


# (4) ??곌????? 遺??????? ?????? ???泥?由? 

# ??⑥?? ?????곕?? ??⑥?? ?????? (湲몄?? 2~4??ъ?? ???湲? ??⑥?? 異?異?)
filter1 <- function(x){
  nchar(x) <= 4 && nchar(x) >= 2 && is.hangul(x)
}
 
filter2 <- function(x){
  Filter(filter1, x)
}

# 以? ??⑥??濡? 異?異???? ??⑥?? ???泥?由? 
lword <- sapply(lword, filter2)
lword

# (5) ??몃???????? ??????

# ??곌??遺??????? ?????? ??⑦?ㅼ?? ??ㅼ??
#install.packages("arules")
library(arules) 

# ??몃???????? ?????? 
wordtran <- as(lword, "transactions") # lword??? 以?蹂듬?곗?댄?곌?? ?????쇰㈃ error諛????
wordtran 

# (6) ??⑥?? 媛? ??곌??洹?移? ??곗?? 
# default (support吏?吏????=0.1, confidence???猶곕??=0.8, maxlen理????湲몄??=10)
# 吏?吏??????? ???猶곕??瑜? ?????대㈃ 諛?寃щ????? 洹?移????媛? 以???대??
tranrules <- apriori(wordtran, parameter=list(supp=0.25, conf=0.05)) 
tranrules <- apriori(wordtran, parameter=list(supp=0.25, conf=0.8)) 
tranrules <- apriori(wordtran, parameter=list(supp=0.3, conf=0.05)) 

# ??곌??洹?移? ?????? 寃곌낵蹂닿린 
inspect(tranrules) # ??곌??洹?移? ?????? 寃곌낵(59媛?) 蹂닿린

# (7)  ??곌????? ???媛???? 

# ??곌????⑥?? ???媛????瑜? ?????댁?? ???猷?援ъ“ 蹂?寃?
rules <- labels(tranrules, ruleSep=" ")  
rules
class(rules)

# 臾몄????대?? 臾띠?? ??곌????⑥?대?? ?????ш뎄議? 蹂?寃? 
rules <- sapply(rules, strsplit, " ",  USE.NAMES=F) 
rules
class(rules) 

# ??? ??⑥??濡? 臾띠?댁?? matrix濡? 諛????
rulemat <- do.call("rbind", rules)
rulemat
class(rulemat)

# ??곌????? ???媛????瑜? ?????? igraph ??⑦?ㅼ?? ??ㅼ??
#install.packages("igraph") # graph.edgelist(), plot.igraph(), closeness() ??⑥?? ???怨?
library(igraph)   

# edgelist蹂닿린 - ??곌????⑥?대?? ?????? ????????? 紐⑸?? ???怨? 
ruleg <- graph.edgelist(rulemat[c(12:59),], directed=F) # [1,]~[11,] "{}" ??????
ruleg

#  edgelist ???媛????
#X11()
plot.igraph(ruleg, vertex.label=V(ruleg)$name,
            vertex.label.cex=1.2, vertex.label.color='black', 
            vertex.size=20, vertex.color='green', vertex.frame.color='blue')

#############################
# 3. ??ㅼ??媛? ??댁?? ???吏?怨? 遺????
#############################

# ?????ㅽ?몃????대????? ?????? ??⑦?ㅼ?? ??ㅼ?? 
#install.packages("https://cran.rstudio.com/bin/windows/contrib/3.4/KoNLP_0.80.1.zip")
#install.packages("Sejong")
#install.packages("wordcloud")
#install.packages("tm")
#install.packages("RSQLite")
#install.packages("hash")
#install.packages("tau")
#install.packages("httr")
#install.packages("XML")
#install.packages("rlang")

library(RSQLite)
library(KoNLP)
library(tm)
library(wordcloud)
library(httr)
library(XML)

# (1) URL ???泥?
url <- "https://news.naver.com/"
web <- GET(url)
web

# (2) HTML ??????
html <- htmlTreeParse(web, useInternalNodes = T, trim=T, encoding="utf-8")
rootNode <- xmlRoot(html)
rootNode

# (3) ???洹? ???猷? ???吏?
# <div class="main_content_inner _content_inner">
news <- xpathSApply(rootNode, "//div[@class='main_content_inner _content_inner']", xmlValue)
news

# (4) ???吏???? ???猷? ???泥?由?
news_pre <- gsub('[\r\n\t]', '', news) 
news_pre <- gsub('[a-z]','',news_pre)
news_pre <- gsub('[A-Z]','',news_pre)
news_pre <- gsub('\\s+',' ',news_pre)
news_pre <- gsub('[[:cntrl:]]','',news_pre)
news_pre <- gsub('[[:punct:]]','',news_pre)
news_pre <- gsub('\\d+',' ',news_pre)
news_pre

# (5) ?????? 遺????
# ??⑥?? 異?異?
library(KoNLP)
news_noun <- extractNoun(news_pre)
news_noun

#留?萸?移? ??????
library(tm)
newsCorpus <- Corpus(VectorSource(news_noun))
TDM <- TermDocumentMatrix(newsCorpus, control=list(wordLengths=c(4,16)))
TDM
tdm.df <- as.data.frame(as.matrix(TDM))
dim(tdm.df)
tdm.df

wordResult <- sort(rowSums(tdm.df),decreasing =T)
wordResult

wordResult <- wordResult[-c(1:6)]

library(wordcloud)
myNames <- names(wordResult)
df <- data.frame(word=myNames, freq=wordResult)
df
pal <- brewer.pal(12,"Paired")
wordcloud(df$word, df$freq, min.freq=2, random.order=F, scale=c(4,0.7), 
          rot.per=0.1, colors=pal, family="malgun")

windowsFonts(A=windowsFont("serif"))



